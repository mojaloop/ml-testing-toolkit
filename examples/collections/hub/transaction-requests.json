{
  "name": "transaction-requests-tests",
  "inputValues": {
    "fromIdType": "MSISDN",
    "fromIdValue": "44123456789",
    "fromFirstName": "Firstname-Test",
    "fromLastName": "Lastname-Test",
    "fromDOB": "1984-01-01",
    "note": "test",
    "currency": "USD",
    "amount": "100",
    "homeTransactionId": "123ABC",
    "fromFspId": "testingtoolkitdfsp",
    "accept": "application/vnd.interoperability.parties+json;version=1.0",
    "contentType": "application/vnd.interoperability.parties+json;version=1.0",
    "toIdValue": "27713803912",
    "toIdType": "MSISDN",
    "toFspId": "payeefsp",
    "acceptQuotes": "application/vnd.interoperability.quotes+json;version=1.0",
    "contentTypeQuotes": "application/vnd.interoperability.quotes+json;version=1.0",
    "acceptTransfers": "application/vnd.interoperability.transfers+json;version=1.0",
    "contentTransfers": "application/vnd.interoperability.transfers+json;version=1.0",
    "HOST_CENTRAL_LEDGER": "http://central-ledger.local",
    "BASE_CENTRAL_LEDGER_ADMIN": "",
    "HUB_OPERATOR_BEARER_TOKEN": "NOT_APPLICABLE",
    "hub_operator": "NOT_APPLICABLE",
    "payerfsp": "testingtoolkitdfsp",
    "HOST_ML_API_ADAPTER": "http://ml-api-adapter.local",
    "accountId": "6",
    "payeefsp": "payeefsp",
    "receiverMSISDN": "27713803912",
    "ilpPacket": "AQAAAAAAAADIEHByaXZhdGUucGF5ZWVmc3CCAiB7InRyYW5zYWN0aW9uSWQiOiIyZGY3NzRlMi1mMWRiLTRmZjctYTQ5NS0yZGRkMzdhZjdjMmMiLCJxdW90ZUlkIjoiMDNhNjA1NTAtNmYyZi00NTU2LThlMDQtMDcwM2UzOWI4N2ZmIiwicGF5ZWUiOnsicGFydHlJZEluZm8iOnsicGFydHlJZFR5cGUiOiJNU0lTRE4iLCJwYXJ0eUlkZW50aWZpZXIiOiIyNzcxMzgwMzkxMyIsImZzcElkIjoicGF5ZWVmc3AifSwicGVyc29uYWxJbmZvIjp7ImNvbXBsZXhOYW1lIjp7fX19LCJwYXllciI6eyJwYXJ0eUlkSW5mbyI6eyJwYXJ0eUlkVHlwZSI6Ik1TSVNETiIsInBhcnR5SWRlbnRpZmllciI6IjI3NzEzODAzOTExIiwiZnNwSWQiOiJwYXllcmZzcCJ9LCJwZXJzb25hbEluZm8iOnsiY29tcGxleE5hbWUiOnt9fX0sImFtb3VudCI6eyJjdXJyZW5jeSI6IlVTRCIsImFtb3VudCI6IjIwMCJ9LCJ0cmFuc2FjdGlvblR5cGUiOnsic2NlbmFyaW8iOiJERVBPU0lUIiwic3ViU2NlbmFyaW8iOiJERVBPU0lUIiwiaW5pdGlhdG9yIjoiUEFZRVIiLCJpbml0aWF0b3JUeXBlIjoiQ09OU1VNRVIiLCJyZWZ1bmRJbmZvIjp7fX19",
    "condition": "HOr22-H3AfTDHrSkPjJtVPRdKouuMkDXTR4ejlQa8Ks",
    "HOST_QUOTING_SERVICE": "http://quoting-service.local",
    "HOST_ACCOUNT_LOOKUP_SERVICE": "http://account-lookup-service.local",
    "HOST_SIMULATOR": "http://moja-simulator.local",
    "HOST_CENTRAL_SETTLEMENT": "http://central-settlement.local/v1",
    "HOST_TRANSACTION_REQUESTS_SERVICE": "http://transaction-request-service.local"
  },
  "test_cases": [
    {
      "id": 9,
      "name": "received State",
      "requests": [
        {
          "id": 1,
          "description": "Payee initiate and send Received request",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "body": {
            "transactionRequestId": "{$environment.transactionRequestId}",
            "payee": {
              "partyIdInfo": {
                "partyIdType": "PERSONAL_ID",
                "partyIdentifier": "16135551212",
                "partySubIdOrType": "DRIVING_LICENSE",
                "fspId": "1234"
              },
              "merchantClassificationCode": "4321",
              "name": "Justin Trudeau",
              "personalInfo": {
                "complexName": {
                  "firstName": "Justin",
                  "middleName": "Pierre",
                  "lastName": "Trudeau"
                },
                "dateOfBirth": "1971-12-25"
              }
            },
            "payer": {
              "partyIdType": "PERSONAL_ID",
              "partyIdentifier": "16135551212",
              "partySubIdOrType": "DRIVING_LICENSE",
              "fspId": "1234"
            },
            "amount": {
              "currency": "USD",
              "amount": "123.45"
            },
            "transactionType": {
              "scenario": "DEPOSIT",
              "subScenario": "CUSTOM_SUBSCENARIO",
              "initiator": "PAYEE",
              "initiatorType": "CONSUMER",
              "refundInfo": {
                "originalTransactionId": "{$environment.transactionRequestId}",
                "refundReason": "free text indicating reason for the refund"
              },
              "balanceOfPayments": "123"
            },
            "note": "Free-text memo",
            "geoCode": {
              "latitude": "+45.4215",
              "longitude": "+75.6972"
            },
            "authenticationType": "OTP",
            "expiration": "{$environment.transferExpiration}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payeefsp",
            "FSPIOP-Destination": "payerfsp"
          },
          "ignoreCallbacks": true,
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.transactionRequestResponse.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 2,
                "description": "transactionId matches",
                "exec": [
                  "expect(environment.transactionRequestResponse.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 3,
                "description": "fspiop-source is payerfsp",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-source']).to.equal('payerfsp');"
                ]
              },
              {
                "id": 4,
                "description": "fspiop-destination is payeefsp",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-destination']).to.equal('payeefsp')"
                ]
              },
              {
                "id": 5,
                "description": "fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 6,
                "description": "content-type is same as sent in the request",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 7,
                "description": "transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.transactionRequestResponse.data['transactionRequestState']).to.eql('RECEIVED')"
                ]
              },
              {
                "id": 8,
                "description": "send RECEIVED state status is 200",
                "exec": [
                  "expect(environment.transactionRequestSendStateResponseObject.code).to.equal(200)"
                ]
              },
              {
                "id": 9,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 10,
                "description": "put transactionId matches",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 11,
                "description": "put fspiop-source is payerfsp",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-source']).to.equal('payerfsp');"
                ]
              },
              {
                "id": 12,
                "description": "put fspiop-destination is payeefsp",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-destination']).to.equal('payeefsp')"
                ]
              },
              {
                "id": 13,
                "description": "put fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 14,
                "description": "put content-type is same as sent in the request",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 15,
                "description": "put transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data['transactionRequestState']).to.eql('RECEIVED')"
                ]
              },
              {
                "id": 16,
                "description": "Status code is 200",
                "exec": [
                  "expect(response.status).to.equal(202)"
                ]
              },
              {
                "id": 17,
                "description": "health status code is 200",
                "exec": [
                  "expect(environment.healthResponseObject.code).to.equal(200)"
                ]
              },
              {
                "id": 18,
                "description": "health Expected Status is OK",
                "exec": [
                  "expect(environment.healthResponseObject.status).to.equal('OK')"
                ]
              }
            ]
          },
          "scripts": {
            "preRequest": {
              "exec": [
                "var uuid = require('uuid');",
                "",
                "pm.environment.set('transactionRequestDate', (new Date()).toUTCString());",
                "pm.environment.set('transactionRequestId', uuid.v4());",
                "pm.environment.set('transferExpiration', new Date(new Date().getTime() + 600000));",
                "",
                "pm.sendRequest(pm.environment.get(\"HOST_QUOTING_SERVICE\")+\"/health\", function (err, response) {",
                "    console.log(\"healthResponseObject: \", response)",
                "    pm.environment.set(\"healthResponse\", response.json())",
                "    pm.environment.set(\"healthResponseObject\", response)",
                "  });"
              ]
            },
            "postRequest": {
              "exec": [
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    console.log(\"transactionRequestResponseObject: \", response)",
                "    pm.environment.set(\"transactionRequestResponse\", response.json())",
                "    pm.environment.set(\"transactionRequestResponseObject\", response)",
                "  });",
                "}, 500)",
                "",
                "setTimeout(function () {",
                "  pm.sendRequest({",
                "    url: pm.environment.get(\"HOST_TRANSACTION_REQUESTS_SERVICE\")+\"/transactionRequests/\"+pm.environment.get(\"transactionRequestId\"),",
                "    method: 'PUT',",
                "    header: {",
                "      'Accept' : 'application/vnd.interoperability.transactionRequests+json;version=1',",
                "      'Content-Type': 'application/vnd.interoperability.transactionRequests+json;version=1.0',",
                "      'Date': pm.environment.get(\"transactionRequestDate\"),",
                "      'fspiop-source': 'payerfsp',",
                "      'fspiop-destination': 'payeefsp',",
                "      'fspiop-uri': '/transactionRequests/' + pm.environment.get(\"transactionRequestId\"),",
                "      'fspiop-http-method': 'PUT',",
                "    },",
                "    body: {",
                "      mode: 'raw',",
                "      raw: JSON.stringify({",
                "        \"transactionId\": pm.environment.get(\"transactionRequestId\"),",
                "        \"transactionRequestState\": \"RECEIVED\"",
                "      })",
                "    }",
                "  }, function (err, response) {",
                "    const responseJson = response.json()",
                "    console.log(\"transactionRequestSendStateResponseObject: \", response)",
                "    pm.environment.set(\"transactionRequestSendStateResponse\", response.json())",
                "    pm.environment.set(\"transactionRequestSendStateResponseObject\", response)",
                "  });",
                "}, 1000)",
                "",
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    console.log(\"transactionRequestSendStateCallbackObject: \", response)",
                "    pm.environment.set(\"transactionRequestSendStateCallback\", response.json())",
                "    pm.environment.set(\"transactionRequestSendStateCallbackObject\", response)",
                "  });",
                "}, 1500)"
              ]
            }
          }
        },
        {
          "id": 2,
          "description": "Check transactionRequest state",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests/{ID}",
          "path": "/transactionRequests/{$environment.transactionRequestId}",
          "method": "get",
          "params": {
            "ID": "{$environment.transactionRequestId}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "FSPIOP-Destination": "payeefsp"
          },
          "ignoreCallbacks": true,
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 2,
                "description": "transactionId matches",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 3,
                "description": "fspiop-source is payeefsp",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-source']).to.equal('payeefsp');"
                ]
              },
              {
                "id": 4,
                "description": "fspiop-destination is payerfsp",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-destination']).to.equal('payerfsp')"
                ]
              },
              {
                "id": 5,
                "description": "fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 6,
                "description": "content-type is same as sent in the request",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 7,
                "description": "transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data['transactionRequestState']).to.eql('RECEIVED')"
                ]
              },
              {
                "id": 8,
                "description": "Status code is 202",
                "exec": [
                  "expect(response.status).to.equal(202)"
                ]
              }
            ]
          },
          "scripts": {
            "preRequest": {
              "exec": [
                "pm.environment.set('transactionRequestDate', (new Date()).toUTCString());"
              ]
            },
            "postRequest": {
              "exec": [
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    const responseJson = response.json()",
                "    console.log(responseJson)",
                "    pm.environment.set(\"checkTransactionRequestStateCallback\", responseJson)",
                "  });",
                "}, 500)"
              ]
            }
          }
        }
      ]
    },
    {
      "id": 10,
      "name": "reject State",
      "requests": [
        {
          "id": 1,
          "description": "Payee initiate and send Received request",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "body": {
            "transactionRequestId": "{$environment.transactionRequestId}",
            "payee": {
              "partyIdInfo": {
                "partyIdType": "PERSONAL_ID",
                "partyIdentifier": "16135551212",
                "partySubIdOrType": "DRIVING_LICENSE",
                "fspId": "1234"
              },
              "merchantClassificationCode": "4321",
              "name": "Justin Trudeau",
              "personalInfo": {
                "complexName": {
                  "firstName": "Justin",
                  "middleName": "Pierre",
                  "lastName": "Trudeau"
                },
                "dateOfBirth": "1971-12-25"
              }
            },
            "payer": {
              "partyIdType": "PERSONAL_ID",
              "partyIdentifier": "16135551212",
              "partySubIdOrType": "DRIVING_LICENSE",
              "fspId": "1234"
            },
            "amount": {
              "currency": "USD",
              "amount": "123.45"
            },
            "transactionType": {
              "scenario": "DEPOSIT",
              "subScenario": "CUSTOM_SUBSCENARIO",
              "initiator": "PAYEE",
              "initiatorType": "CONSUMER",
              "refundInfo": {
                "originalTransactionId": "{$environment.transactionRequestId}",
                "refundReason": "free text indicating reason for the refund"
              },
              "balanceOfPayments": "123"
            },
            "note": "Free-text memo",
            "geoCode": {
              "latitude": "+45.4215",
              "longitude": "+75.6972"
            },
            "authenticationType": "OTP",
            "expiration": "{$environment.transferExpiration}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payeefsp",
            "FSPIOP-Destination": "payerfsp"
          },
          "ignoreCallbacks": true,
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.transactionRequestResponse.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 2,
                "description": "transactionId matches",
                "exec": [
                  "expect(environment.transactionRequestResponse.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 3,
                "description": "fspiop-source is payerfsp",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-source']).to.equal('payerfsp');"
                ]
              },
              {
                "id": 4,
                "description": "fspiop-destination is payeefsp",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-destination']).to.equal('payeefsp')"
                ]
              },
              {
                "id": 5,
                "description": "fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 6,
                "description": "content-type is same as sent in the request",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 7,
                "description": "transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.transactionRequestResponse.data['transactionRequestState']).to.eql('RECEIVED')"
                ]
              },
              {
                "id": 8,
                "description": "Status code is 202",
                "exec": [
                  "expect(response.status).to.equal(202)"
                ]
              }
            ]
          },
          "scripts": {
            "preRequest": {
              "exec": [
                "var uuid = require('uuid');",
                "",
                "pm.environment.set('transactionRequestDate', (new Date()).toUTCString());",
                "pm.environment.set('transactionRequestId', uuid.v4());",
                "pm.environment.set('transferExpiration', new Date(new Date().getTime() + 600000));"
              ]
            },
            "postRequest": {
              "exec": [
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    console.log(\"transactionRequestResponse: \", response)",
                "    pm.environment.set(\"transactionRequestResponseObject\", response)",
                "    pm.environment.set(\"transactionRequestResponse\", response.json())",
                "  });",
                "}, 500)"
              ]
            }
          }
        },
        {
          "id": 2,
          "description": "Check transactionRequest state",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests/{ID}",
          "path": "/transactionRequests/{$environment.transactionRequestId}",
          "method": "get",
          "params": {
            "ID": "{$environment.transactionRequestId}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "FSPIOP-Destination": "payeefsp"
          },
          "ignoreCallbacks": true,
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 2,
                "description": "transactionId matches",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 3,
                "description": "fspiop-source is payeefsp",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-source']).to.equal('payeefsp');"
                ]
              },
              {
                "id": 4,
                "description": "fspiop-destination is payerfsp",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-destination']).to.equal('payerfsp')"
                ]
              },
              {
                "id": 5,
                "description": "fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 6,
                "description": "content-type is same as sent in the request",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 7,
                "description": "transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.checkTransactionRequestStateCallback.data['transactionRequestState']).to.eql('RECEIVED')"
                ]
              },
              {
                "id": 8,
                "description": "send RECEIVED state status is 200",
                "exec": [
                  "expect(environment.transactionRequestSendStateResponseObject.code).to.eql(200)"
                ]
              },
              {
                "id": 9,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 10,
                "description": "put transactionId matches",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data['transactionId']).to.equal(environment.transactionRequestId);"
                ]
              },
              {
                "id": 11,
                "description": "put fspiop-source is payerfsp",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-source']).to.equal('payerfsp');"
                ]
              },
              {
                "id": 12,
                "description": "put fspiop-destination is payeefsp",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-destination']).to.equal('payeefsp')"
                ]
              },
              {
                "id": 13,
                "description": "put fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 14,
                "description": "put content-type is same as sent in the request",
                "exec": [
                  "expect(environment.transactionRequestResponse.headers['content-type']).to.equal('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 15,
                "description": "put transactionRequestState is RECEIVED",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallback.data['transactionRequestState']).to.eql('REJECTED')"
                ]
              },
              {
                "id": 16,
                "description": "send REJECT state status is 200",
                "exec": [
                  "expect(environment.transactionRequestSendStateCallbackObject.code).to.eql(200)"
                ]
              }
            ]
          },
          "scripts": {
            "preRequest": {
              "exec": [
                "pm.environment.set('transactionRequestDate', (new Date()).toUTCString());"
              ]
            },
            "postRequest": {
              "exec": [
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    const responseJson = response.json()",
                "    console.log(\"checkTransactionRequestStateCallbackObject: \", response)",
                "    pm.environment.set(\"checkTransactionRequestStateCallback\", responseJson)",
                "    pm.environment.set(\"checkTransactionRequestStateCallbackObject\", response)",
                "  });",
                "}, 500)",
                "",
                "setTimeout(function () {",
                "  pm.sendRequest({",
                "    url: pm.environment.get(\"HOST_TRANSACTION_REQUESTS_SERVICE\")+\"/transactionRequests/\"+pm.environment.get(\"transactionRequestId\"),",
                "    method: 'PUT',",
                "    header: {",
                "      'Accept' : 'application/vnd.interoperability.transactionRequests+json;version=1',",
                "      'Content-Type': 'application/vnd.interoperability.transactionRequests+json;version=1.0',",
                "      'Date': pm.environment.get(\"transactionRequestDate\"),",
                "      'fspiop-source': 'payerfsp',",
                "      'fspiop-destination': 'payeefsp',",
                "      'fspiop-uri': '/transactionRequests/' + pm.environment.get(\"transactionRequestId\"),",
                "      'fspiop-http-method': 'PUT',",
                "    },",
                "    body: {",
                "      mode: 'raw',",
                "      raw: JSON.stringify({",
                "        \"transactionId\": pm.environment.get(\"transactionRequestId\"),",
                "        \"transactionRequestState\": \"REJECTED\"",
                "      })",
                "    }",
                "  }, function (err, response) {",
                "    const responseJson = response.json()",
                "    console.log(\"transactionRequestSendStateResponseObject: \", response)",
                "    pm.environment.set(\"transactionRequestSendStateResponse\", responseJson)",
                "    pm.environment.set(\"transactionRequestSendStateResponseObject\", response)",
                "  });",
                "}, 1000)",
                "",
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    const responseJson = response.json()",
                "    console.log(\"transactionRequestSendStateCallbackObject: \", response)",
                "    pm.environment.set(\"transactionRequestSendStateCallback\", responseJson)",
                "    pm.environment.set(\"transactionRequestSendStateCallbackObject\", response)",
                "  });",
                "}, 1500)"
              ]
            }
          }
        }
      ]
    },
    {
      "id": 11,
      "name": "error framework",
      "requests": [
        {
          "id": 1,
          "description": "Check unknown transactionID - error code and description",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests/{ID}",
          "path": "/transactionRequests/{$environment.transactionRequestId}",
          "method": "get",
          "params": {
            "ID": "{$environment.transactionRequestId}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "ignoreCallbacks": true,
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payeefsp",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payerfsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Callback received in the Simulator",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.data).to.not.equal(undefined)"
                ]
              },
              {
                "id": 2,
                "description": "transactionId matches",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.data['transactionId']).to.equal(undefined)"
                ]
              },
              {
                "id": 3,
                "description": "fspiop-source is payerfsp",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.headers['fspiop-source']).to.eql('payerfsp')"
                ]
              },
              {
                "id": 4,
                "description": "fspiop-destination is payeefsp",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.headers['fspiop-destination']).to.equal('payeefsp')"
                ]
              },
              {
                "id": 5,
                "description": "fspiop-http-method is PUT",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.headers['fspiop-http-method']).to.equal('PUT')"
                ]
              },
              {
                "id": 6,
                "description": "content-type is same as sent in the request",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.headers['content-type']).to.eql('application/vnd.interoperability.transactionRequests+json;version=1.0')"
                ]
              },
              {
                "id": 7,
                "description": "Check ID missing",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.data.errorInformation.errorDescription).to.equal(`Transaction request ID not found - Transaction Request id ${environment.transactionRequestId} not found`)"
                ]
              },
              {
                "id": 8,
                "description": "Check Error code 3206",
                "exec": [
                  "expect(environment.checkUnknownTransactionIDCallback.data.errorInformation.errorCode).to.equal('3206')"
                ]
              },
              {
                "id": 9,
                "description": "Status code is 202",
                "exec": [
                  "expect(response.status).to.equal(202)"
                ]
              }
            ]
          },
          "scripts": {
            "postRequest": {
              "exec": [
                "setTimeout(function () {",
                "  pm.sendRequest(pm.environment.get(\"HOST_SIMULATOR\")+\"/transactionRequests/callbacks/\"+pm.environment.get(\"transactionRequestId\"), function (err, response) {",
                "    pm.environment.set(\"checkUnknownTransactionIDCallback\", response.json())",
                "  });",
                "}, 2000)"
              ]
            },
            "preRequest": {
              "exec": [
                "var uuid = require('uuid');",
                "",
                "pm.environment.set('transactionRequestId', uuid.v4());"
              ]
            }
          }
        },
        {
          "id": 2,
          "description": "3100 - Missing body",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "ignoreCallbacks": true,
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Status code is 400",
                "exec": [
                  "expect(response.status).to.equal(400)"
                ]
              },
              {
                "id": 2,
                "description": "Check Generic validation error ",
                "exec": [
                  "expect(response.data.errorInformation.errorDescription).to.equal('Generic validation error - \\\"TransactionRequestsPostRequest\\\" must be an object')"
                ]
              },
              {
                "id": 3,
                "description": "Check Error code 3100",
                "exec": [
                  "expect(response.data.errorInformation.errorCode).to.equal('3100')"
                ]
              }
            ]
          },
          "body": null
        },
        {
          "id": 3,
          "description": "3102 - Missing Date ",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "ignoreCallbacks": true,
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "FSPIOP-Source": "payerfsp",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Status code is 400",
                "exec": [
                  "expect(response.status).to.equal(400)"
                ]
              },
              {
                "id": 2,
                "description": "Missing mandatory element - date is required",
                "exec": [
                  "expect(response.data.errorInformation.errorDescription).to.equal('Missing mandatory element - date is required')"
                ]
              },
              {
                "id": 3,
                "description": "Check Error code 3102",
                "exec": [
                  "expect(response.data.errorInformation.errorCode).to.equal('3102')"
                ]
              }
            ]
          },
          "body": null
        },
        {
          "id": 4,
          "description": "3102 - Missing fspiop-source",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "ignoreCallbacks": true,
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Status code is 400",
                "exec": [
                  "expect(response.status).to.equal(400)"
                ]
              },
              {
                "id": 2,
                "description": "Missing mandatory element - fspiop-source is required",
                "exec": [
                  "expect(response.data.errorInformation.errorDescription).to.equal('Missing mandatory element - fspiop-source is required')"
                ]
              },
              {
                "id": 3,
                "description": "Check Error code 3102",
                "exec": [
                  "expect(response.data.errorInformation.errorCode).to.equal('3102')"
                ]
              }
            ]
          },
          "body": null
        },
        {
          "id": 5,
          "description": "3001 - Wrong content version ",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "ignoreCallbacks": true,
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+json;version=4.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Status code is 406",
                "exec": [
                  "expect(response.status).to.equal(406)"
                ]
              },
              {
                "id": 2,
                "description": "Check Unacceptable version requested",
                "exec": [
                  "expect(response.data.errorInformation.errorDescription).to.equal('Unacceptable version requested - Client supplied a protocol version which is not supported by the server')"
                ]
              },
              {
                "id": 3,
                "description": "Check Error code 3001",
                "exec": [
                  "expect(response.data.errorInformation.errorCode).to.equal('3001')"
                ]
              }
            ]
          },
          "body": null
        },
        {
          "id": 6,
          "description": "3101 - Unsupported Media Type",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/transactionRequests",
          "path": "/transactionRequests",
          "method": "post",
          "ignoreCallbacks": true,
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "headers": {
            "Content-Type": "application/vnd.interoperability.transactionRequests+xml;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "Accept": "application/vnd.interoperability.transactionRequests+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Status code is 400",
                "exec": [
                  "expect(response.status).to.equal(400)"
                ]
              },
              {
                "id": 2,
                "description": "Check Malformed syntax - Unsupported Media Type",
                "exec": [
                  "expect(response.data.errorInformation.errorDescription).to.equal('Malformed syntax - Unsupported Media Type')"
                ]
              },
              {
                "id": 3,
                "description": "Check Error code 3101",
                "exec": [
                  "expect(response.data.errorInformation.errorCode).to.equal('3101')"
                ]
              }
            ]
          },
          "body": null
        }
      ]
    },
    {
      "id": 12,
      "name": "authorizations",
      "requests": [
        {
          "id": 1,
          "description": "authorizations",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "fspiop",
            "asynchronous": true
          },
          "operationPath": "/authorizations/{ID}",
          "path": "/authorizations/{$environment.tran}",
          "method": "get",
          "params": {
            "ID": "{$environment.tran}"
          },
          "url": "{$inputs.HOST_TRANSACTION_REQUESTS_SERVICE}",
          "ignoreCallbacks": true,
          "headers": {
            "Content-Type": "application/vnd.interoperability.authorizations+json;version=1.0",
            "Date": "{$function.generic.curDate}",
            "FSPIOP-Source": "payerfsp",
            "Accept": "application/vnd.interoperability.authorizations+json;version=1",
            "FSPIOP-Destination": "payeefsp"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "getAuthroziation Status code is 202",
                "exec": [
                  "expect(environment.getAuthorization.code).to.equal(202)"
                ]
              },
              {
                "id": 2,
                "description": "putAuthroziation Status code is 200",
                "exec": [
                  "expect(environment.putAuthorization.code).to.equal(200)"
                ]
              }
            ]
          },
          "scripts": {
            "preRequest": {
              "exec": [
                "var uuid = require('uuid');",
                "",
                "pm.environment.set('transactionRequestDate', (new Date()).toUTCString());",
                "pm.environment.set('transactionRequestId', uuid.v4());",
                "",
                "{",
                "  pm.sendRequest({",
                "    url: pm.environment.get(\"HOST_TRANSACTION_REQUESTS_SERVICE\")+\"/authorizations/\"+pm.environment.get(\"transactionRequestId\") + \"?authenticationType=OTP&retriesLeft=2&amount=102&currency=USD\",",
                "    method: 'GET',",
                "    header: {",
                "      'Accept' : 'application/vnd.interoperability.authorizations+json;version=1',",
                "      'Content-Type': 'application/vnd.interoperability.authorizations+json;version=1.0',",
                "      'Date': pm.environment.get(\"transactionRequestDate\"),",
                "      'fspiop-source': 'payerfsp',",
                "      'fspiop-destination': 'payeefsp',",
                "      'fspiop-uri': '/transactionRequests/' + pm.environment.get(\"transactionRequestId\") + \"?authenticationType=OTP&retriesLeft=2&amount=102&currency=USD\",",
                "      'fspiop-http-method': 'GET',",
                "    }",
                "  }, function (err, response) {",
                "    console.log(\"getAuthorization: \", response)",
                "    pm.environment.set(\"getAuthorization\", response)",
                "  });",
                "}",
                "",
                "{",
                "  pm.sendRequest({",
                "    url: pm.environment.get(\"HOST_TRANSACTION_REQUESTS_SERVICE\")+\"/authorizations/\"+pm.environment.get(\"transactionRequestId\"),",
                "    method: 'PUT',",
                "    header: {",
                "      'Accept' : 'application/vnd.interoperability.authorizations+json;version=1',",
                "      'Content-Type': 'application/vnd.interoperability.authorizations+json;version=1.0',",
                "      'Date': pm.environment.get(\"transactionRequestDate\"),",
                "      'fspiop-source': 'payeefsp',",
                "      'fspiop-destination': 'payerfsp',",
                "      'fspiop-uri': '/transactionRequests/' + pm.environment.get(\"transactionRequestId\"),",
                "      'fspiop-http-method': 'PUT',",
                "    },",
                "    body: {",
                "      mode: 'raw',",
                "      raw: JSON.stringify({",
                "        \"authenticationInfo\": {",
                "          \"authentication\": \"OTP\",",
                "          \"authenticationValue\": \"234567\"",
                "        },",
                "        \"responseType\": \"REJECTED\"",
                "      })",
                "    }",
                "  }, function (err, response) {",
                "    console.log(\"putAuthorization: \", response)",
                "    pm.environment.set(\"putAuthorization\", response)",
                "  });",
                "}"
              ]
            },
            "postRequest": {
              "exec": [
                ""
              ]
            }
          }
        }
      ]
    }
  ]
}